<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>SAMEMO ‚Äî Scanner</title>

<style>
body{
  margin:0;
  background:#0f172a;
  color:#fff;
  font-family:system-ui,sans-serif;
  display:flex;
  align-items:center;
  justify-content:center;
  height:100vh;
}
.box{
  text-align:center;
}
h1{
  font-size:28px;
  margin-bottom:8px;
}
p{
  opacity:.8;
}
.error{
  color:#f87171;
  margin-top:12px;
}
</style>
</head>

<body>
<div class="box">
  <h1>SAMEMO</h1>
  <p>Scanne un code pour continuer</p>
  <div id="reader" style="width:280px;margin:auto"></div>
  <div id="msg" class="error"></div>
</div>

<script src="https://unpkg.com/html5-qrcode"></script>
<script>
const msg = document.getElementById("msg");

function route(code){
  code = code.trim();

  // üì¶ COMMANDE
  if(code.startsWith("CMD-")){
    location.href = `/prepa-cmd.html?cmd=${encodeURIComponent(code)}`;
    return;
  }

  // üß∫ BAC TAMPON
  if(code.startsWith("BAC-")){
    location.href = `/prepa-bac.html?bac=${encodeURIComponent(code)}`;
    return;
  }

  // üë§ R√îLE
  if(code.startsWith("ROLE:")){
    const role = code.split(":")[1];
    localStorage.setItem("role", role);
    location.href = `/prepa-${role.toLowerCase()}.html`;
    return;
  }

  // üè∑Ô∏è PRODUIT (EAN)
  if(/^\d{8,14}$/.test(code)){
    location.href = `/scan-produit.html?ean=${code}`;
    return;
  }

  msg.textContent = "Code non reconnu";
}

const scanner = new Html5Qrcode("reader");

scanner.start(
  { facingMode:"environment" },
  { fps:10, qrbox:250 },
  code => {
    scanner.stop();
    route(code);
  },
  () => {}
).catch(err=>{
  msg.textContent = "Cam√©ra refus√©e";
});
</script>
</body>
</html>
