<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>SAMEMO ‚Äî Remplissage Bac Tampon</title>

<style>
:root{
  --primary:#0f766e;
  --success:#16a34a;
  --error:#dc2626;
  --bg:#f8fafc;
  --card:#ffffff;
  --border:#e5e7eb;
  --disabled:#94a3b8;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,sans-serif;
  background:var(--bg);
}
.app{
  max-width:420px;
  margin:auto;
  padding:16px;
}
.header{
  text-align:center;
  margin-bottom:16px;
}
.logo{
  font-size:26px;
  font-weight:900;
  color:var(--primary);
}
.subtitle{
  font-size:14px;
  color:#475569;
}
.card{
  background:var(--card);
  border-radius:16px;
  padding:16px;
  box-shadow:0 10px 25px rgba(0,0,0,.06);
}
.hidden{display:none}
label{
  font-size:13px;
  font-weight:700;
  margin-top:12px;
  display:block;
}
input{
  width:100%;
  padding:14px;
  margin-top:6px;
  border-radius:12px;
  border:1px solid var(--border);
  background:#f1f5f9;
}
button{
  width:100%;
  margin-top:16px;
  padding:16px;
  border:none;
  border-radius:14px;
  font-size:16px;
  font-weight:800;
  cursor:pointer;
}
.primary{background:var(--primary);color:#fff}
.success{background:var(--success);color:#fff}
.disabled{background:var(--disabled);cursor:not-allowed}
.alert{
  text-align:center;
  font-weight:700;
  margin-top:12px;
}
.alert.error{color:var(--error)}
.alert.success{color:var(--success)}
.big{
  font-size:22px;
  font-weight:900;
  text-align:center;
  margin:12px 0;
}
</style>
</head>

<body>
<div class="app">

  <div class="header">
    <div class="logo">SAMEMO</div>
    <div class="subtitle">Remplissage bac tampon</div>
  </div>

  <!-- √âTAPE 1 : SCAN BAC -->
  <div id="screen-scan" class="card">
    <div class="big">üß∫ Scanner le bac</div>
    <input id="bacId" readonly placeholder="QR du bac">
    <button class="primary" onclick="fakeScan()">Simuler scan BAC-T-001</button>
  </div>

  <!-- √âTAPE 2 : INFO BAC -->
  <div id="screen-info" class="card hidden">
    <label>Bac</label>
    <input id="i-bac" readonly>

    <label>Produit attendu</label>
    <input id="i-product" readonly>

    <label>Quantit√© √† ajouter</label>
    <input id="i-qty" readonly>

    <button id="confirmBtn" class="disabled" disabled>
      ‚úÖ Bac rempli
    </button>

    <div id="msg" class="alert"></div>
  </div>

  <!-- √âTAPE 3 : SUCC√àS -->
  <div id="screen-done" class="card hidden">
    <div class="big">üéâ Bac valid√©</div>
    <button class="success" onclick="resetApp()">üîÅ Bac suivant</button>
  </div>

</div>

<script>
/* ========= CONFIG ========= */
const API_URL = "https://script.google.com/macros/s/TON_SCRIPT_ID/exec";

/* ========= DOM ========= */
const screenScan  = document.getElementById("screen-scan");
const screenInfo  = document.getElementById("screen-info");
const screenDone  = document.getElementById("screen-done");

const bacIdInput  = document.getElementById("bacId");
const iBac        = document.getElementById("i-bac");
const iProduct    = document.getElementById("i-product");
const iQty        = document.getElementById("i-qty");
const confirmBtn  = document.getElementById("confirmBtn");
const msg         = document.getElementById("msg");

/* ========= STATE ========= */
let currentBac = null;

/* ========= LOGIC ========= */

// SIMULATION scan (√† remplacer par vrai scanner)
function fakeScan(){
  onScan("BAC-T-001");
}

async function onScan(bacId){
  bacIdInput.value = bacId;
  currentBac = bacId;

  screenScan.classList.add("hidden");
  screenInfo.classList.remove("hidden");

  msg.textContent = "Chargement...";
  msg.className = "alert";

  try{
    const res = await fetch(`${API_URL}?action=bac&bacId=${encodeURIComponent(bacId)}`);
    const d = await res.json();

    if(!d || !d.BAC_ID){
      throw new Error("Bac inconnu");
    }

    iBac.value = d.BAC_ID;
    iProduct.value = `${d.PRODUIT_NOM} (${d.PRODUIT_CODE})`;
    iQty.value = d.QTY_MANQUANT;

    confirmBtn.disabled = false;
    confirmBtn.className = "success";
    msg.textContent = "";

  }catch(e){
    msg.textContent = "‚ùå " + e.message;
    msg.className = "alert error";
  }
}

confirmBtn.onclick = async ()=>{
  confirmBtn.disabled = true;
  msg.textContent = "Validation...";
  msg.className = "alert";

  try{
    const res = await fetch(API_URL,{
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify({
        action:"bacFilled",
        bacId:currentBac
      })
    });

    const r = await res.json();
    if(!r.success) throw new Error(r.error||"Erreur");

    screenInfo.classList.add("hidden");
    screenDone.classList.remove("hidden");

  }catch(e){
    msg.textContent = "‚ùå " + e.message;
    msg.className = "alert error";
    confirmBtn.disabled = false;
  }
};

function resetApp(){
  location.reload();
}
</script>

</body>
</html>
